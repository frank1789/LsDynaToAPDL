build --enable_platform_specific_config

# Use registered clang toolchain.
build:linux --incompatible_enable_cc_toolchain_resolution

# C++20
build --cxxopt=-std=c++20
build --cxxopt=-O3
build --strip=always

# Also add "-lm" flag to avoid linker errors like "undefined reference to nan" for absl
#build:with-absl --action_env=BAZEL_LINKLIBS=-lm
#build:with-absl --define absl=1

#build --config=c++20 --config=with-absl

# Fixes symbols when debugging on mac.
build:macos --features=oso_prefix_is_pwd

# Coverage builds
coverage --config=coverage
build:coverage --action_env=BAZEL_USE_LLVM_NATIVE_COVERAGE=1
build:coverage --action_env=GCOV=llvm-profdata
build:coverage --action_env=BAZEL_LLVM_COV=llvm-cov
build:coverage --experimental_generate_llvm_lcov
build:coverage --collect_code_coverage
build:coverage --combined_report=lcov
